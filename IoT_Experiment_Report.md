# 物联网实验报告

## IAR 实验开发环境

### 实验器材

* 物联网实验箱
* USB线
* 串口线
* PC机（Win7 操作系统，内置 IAR 集成开发环境、超级终端）

在实验过程中，我们首先配置了 IAR 开发环境，并熟悉了实验箱的硬件连接。通过 USB 线和串口线，我们将 PC 机与实验箱连接，确保实验环境的正常运行。

## 蓝牙套件 CC2540 实验

### LED 灯控制实验、定时控制实验

#### 实验内容描述

本实验通过蓝牙 4.0 模块的 P0_0 和 P0_1 引脚控制 LED 灯的亮灭。具体来说，当 P0_0 引脚为低电平时，LED1 亮起；当 P0_1 引脚为高电平时，LED2 亮起。实验通过修改寄存器中对应引脚的值来实现 LED 灯的控制。定时控制实验则利用 CC2540 处理器的 Timer1 定时器进行自动装载计数，并通过查询 IRCON 中断标志来检测 Timer1 定时器计数溢出中断，从而控制 LED 灯的闪烁状态。需要注意的是，参考书中的 LED2 灯电路图存在错误，实际电路与书中描述相反。

#### 实验主要过程

1. 使用 USB 线将 PC 机与物联网实验箱的 CC-debug 接口连接。

2. 启动 IAR 开发环境，创建新工程，或直接使用预设的实验工程：`work\Basic\Exp1`（LED灯控制实验）或 `work\Basic\Exp2`（定时控制实验）。

3. 在 IAR 开发环境中编译、运行和调试程序。

#### 实验现象观测

* **LED灯控制实验**：初始状态下，LED0 亮起，LED1 熄灭。在无限循环中，LED1 的状态不断切换，产生闪烁效果。闪烁速度由延时函数控制，当前设置为 50000 个周期。
* **定时控制实验**：初始状态下，LED0 熄灭，LED1 亮起。每次循环中，检查定时器 T1 是否溢出。如果溢出，LED0 和 LED1 交替闪烁（当 TempFlag 为真时，LED0 和 LED1 的状态相反）。每次循环结束时，LED1 独立闪烁一次，随后引入短暂延时，循环持续进行。

#### 实验原理分析

* **LED实验**：P1 和 P0 寄存器是可读写的数据寄存器，P1DIR 和 P0DIR 是 IO 输入输出选择寄存器。通过修改 P1 和 P0 寄存器的值，可以控制 LED 灯的亮灭。
* **定时控制实验**：T1CTL 是 Timer1 定时器控制状态寄存器，用于设置定时器的模式和预分频系数。IRCON 寄存器为中断标志位寄存器，通过它可以判断 Timer1 的中断状态。

#### 实验总结

在 LED 操作实验与定时器应用实验中，我深刻领悟了硬件与软件之间的紧密协作，特别是 CC2540 芯片的 IO 端口控制机制。实验过程中，通过直接操作寄存器进行配置，我能够直观地实现 LED 的开关控制，从而深化了对嵌入式系统中 IO 端口操作的理解。同时，通过定时器的应用及寄存器的调整，我进一步学习了如何运用中断功能来执行定时任务，感受到了硬件编程的多样性与灵活性。

### 片上温度 AD 实验、串口收发数据实验、声响 / 光敏传感器实验、磁场强度传感器实验、干簧门磁 / 霍尔开关传感器实验

#### 实验内容描述

本次实验主要围绕多种常见传感器的应用展开，涵盖了温度传感器、声光传感器、磁场强度传感器以及干簧门磁和霍尔开关传感器。实验的核心在于利用这些传感器对环境变化做出响应，其工作原理基于电阻的变化。传感器将这种变化转换为可测量的信号，并通过串口将数据传输至PC端，实现实时监控。

#### 实验主要过程

1. **硬件连接**：将传感器正确连接至开发板，确保电源、地线和信号输出线的接线无误。
2. **串口连接**：使用串口线将开发板与 PC 机连接。在 PC 端启动串口调试工具（如超级终端），根据实验手册设置合适的波特率，随后运行代码。
3. **程序运行**：运行程序以激活传感器，并通过串口发送数据。实验过程中，不同阶段会产生不同的反馈，通过串口调试工具观察输出的数据。

#### 实验现象观测

* **片上温度 AD 实验**：初始状态下，LED0 和 LED1 均熄灭。LED0 闪烁表示程序正常运行，LED1 亮起表示温度监测程序正在运行并实时检测温度数据。温度数据通过串口输出，以字符串形式显示在终端中，便于实时监控。
* **串口收发数据实验**：在超级终端中，键盘输入的字符通过串口传输至开发板并反馈回终端。即使输入字符超过 30 个，系统仍能完整显示，确保数据的完整性和实时传输。
* **声光传感器实验**：声响传感器：当发出声音时，显示“Sound Switch!”，表明声音传感器已响应。光敏传感器：用手遮挡光线后再移开，显示“Light Switch!”，证明传感器能够响应光强的变化。
* **磁场强度传感器实验**：使用磁铁靠近传感器时，磁场强度传感器会输出 Hx、Hy、Hz 的值，这些值会随磁场变化而波动，证明传感器能够实时监测磁场强度。
* **干簧门磁 / 霍尔开关传感器实验**：干簧门磁开关：当检测到磁场时，串口输出“Reed Switch!”，表示门磁开关响应了外部磁场。霍尔开关：当霍尔开关检测到磁场时，串口输出“Hall Switch!”，表明霍尔开关响应了磁场变化。

#### 实验原理分析

本实验的核心原理在于传感器对环境变化的响应。各类传感器均配备有敏感元件，通常为电阻。当环境条件发生变化时，传感器内部的电阻值随之改变，进而影响电路中的电压或电流。微控制器通过采集这些变化信号，并进行处理，将其转换为可传输的数据。最终，这些数据通过串口输出至 PC 端，借助串口调试助手或超级终端，可以实时显示环境变化数据，从而实现信息的有效传输。

#### 实验总结

通过本次实验，我深入理解了传感器的工作原理及其在物联网中的重要应用。实验过程中，通过配置 CC2540 处理器的 IOL 和串口通信，成功实现了温度、声光、磁场等多种传感器数据的采集与传输。通过模拟 I2C 时序操作，我掌握了传感器数据的读取和处理流程。实验展示了传感器如何将环境变化转化为电信号，并通过串口等通信方式实时传递信息，揭示了物联网中实时数据传输的关键性。

## ZigBee 套件 CC2530 实验

### 红外对射传感器实验、温湿度传感器实验

#### 实验内容描述

本实验旨在深入学习红外对射传感器的工作原理及其应用，同时掌握 SHT11 温湿度传感器的使用方法及其实时操作时序。通过 IAR 开发环境编写代码，实现红外对射传感器与温湿度传感器的数据采集，并利用 CC2530 的 IO 中断功能监测传感器状态。最终，通过 ZigBee 模块完成数据的传输与显示。

#### 实验主要过程

1. **硬件连接**：将开发板通过 USB 线连接至 PC，选择并配置 ZigBee 设备模块。使用串口线连接开发板与 PC，并通过超级终端将波特率设置为 57600。
2. **仿真设备选择**：在 IAR 开发环境中选择仿真所需的 ZigBee 设备模块，并加载对应的实验代码。
3. **实验操作**：
   * **红外对射传感器实验**：使用厚卡片作为遮挡物，观察红外传感器的工作状态变化。
   * **温湿度传感器实验**：直接观察超级终端的输出，记录温度和湿度的实时变化情况。

#### 实验现象观测

* **红外对射传感器实验**：当使用厚卡片遮挡红外传感器时，超级终端显示 “IRDS warning!”，表明红外束被阻断。此时，ZigBee 模块上的 LED 灯状态发生变化，指示传感器触发了中断。具体表现为，当红外束被遮挡时，LED 灯熄灭。
* **温湿度传感器实验**：运行代码后，超级终端每秒输出当前的温度和湿度值。通过用手捂住传感器，可以观察到温度逐渐升高；松手后，温度逐渐下降，验证了温湿度传感器的灵敏度和快速响应能力。

#### 实验原理分析

* **红外对射传感器原理**：红外对射传感器通过发射红外光并接收反射光，实现对物体遮挡的检测。在本系统中，红外传感器的信号线连接至 ZigBee 模块的 P0_0 引脚，并通过将该引脚配置为中断输入模式，实时监测传感器的状态变化。
* **温湿度传感器原理**：温湿度传感器基于电容原理测量环境中的温度和湿度，并将其转换为模拟信号输出。系统将温湿度传感器的时钟线连接至 ZigBee 模块的 P0_0 引脚，数据线连接至 P0_1 引脚。通过模拟时序操作，系统能够读取传感器的数据，并通过串口将数据传输至 PC 进行显示。

#### 实验总结

通过红外对射传感器和温湿度传感器的实验，我们深入理解了 ZigBee 模块在物联网中的应用。红外对射传感器利用中断机制实现了对遮挡物的实时检测，而温湿度传感器则通过时序操作展示了如何高效读取环境数据。实验过程中，我们发现红外对射传感器对遮挡物的厚度要求较高，这提醒我们在实际应用中，传感器的灵敏度和环境适应性是需要重点优化的关键因素。

## 蓝牙套件 CC2540 无线实验

### TI BLE 4.0 协议栈入门实验、基于 BLE 4.0 的使能从机 Notify 实验

#### 实验内容描述

本实验旨在安装并掌握 TI BLE 4.0 协议栈的使用，熟悉 IAR 工程的配置与操作。通过分析协议栈源码中的 SimpleBLECentral 和 SimpleBLEPeripheral 例程，设计程序实现无线连接，并使能从机的 Notify 功能，从而实现每隔三秒自动向集中器发送数据。

#### 实验主要过程

1. **TI BLE 4.0 协议栈入门实验**：
   * 按照实验指导书的步骤安装BLE协议栈。
   * 安装完成后，进入路径 `C:\BLE-CC254x-1.4.0\Projects\ble\SimpleBLEPeripheral\CC2540DB`，选择 CC2540DK-MINI Keyfob 工程模板。
   * 连接硬件设备，通过 USB 线将 BLE 4.0 模块与开发板连接，并将电源电压调整为 3.3V。
   * 编译工程代码并进行下载调试，验证协议栈的正常运行。
2. **基于 BLE 4.0 的使能从机 Notify 实验**：
   * 通过 USB 和串口线连接硬件设备。
   * 打开路径 `exp\BLE4.0\Basic Examples\Projects\ble`，分别编译并下载 `ptop_central\CC2540` 和 `ptop_peripheral\CC2540DB` 工程到两个 BLE 4.0 模块中。
   * 使用串口线连接设备，并在超级终端中将波特率设置为 57600。
   * 给模块上电，观察 LED 指示灯状态。当红色 LED 由闪烁变为常亮时，表示两个模块成功建立连接。

#### 实验现象观测

* **TI BLE 4.0 协议栈入门实验**：调试完成后，BLE 协议栈能够正常工作，验证了协议栈的安装与配置正确性。
* **基于 BLE 4.0 的使能从机 Notify 实验**：连接成功后，串口终端显示“Notify Value: 3”，表明特征值 4 的值为 0x03，并且成功接收到了从机发送的通知数据，实现了预期的数据传输功能。

#### 实验原理分析

* **BLE连接过程**：集中器发起连接请求，外部设备响应并建立连接。集中器通过特定的 UUID 进行 GATT 数据服务的发现。发现服务后，集中器根据 UUID 发送数据操作请求，从机返回相应的特性句柄。集中器通过特性 UUID 读取或写入数据，完成数据交互。
* **Notify功能**：在使能通知功能后，从机每三秒钟修改特性值 4 的值，并通过通知机制自动发送给中央设备。中央设备接收到通知后，读取特性值 4 并进行相应的数据处理。

#### 实验总结

通过本次实验，我深入学习了基于 TI BLE 4.0 协议栈的蓝牙无线通信原理，并成功实现了 CC2540 模块之间的无线连接。实验中，通过配置并编译 SimpleBLECentral 和 SimpleBLEPeripheral 例程，完成了特性值的读取和写入操作，验证了蓝牙 4.0 模块的通信功能和稳定性。通过定时器每三秒修改特性值并自动发送通知到中央设备，我掌握了从机通知功能的配置和使用，实现了周期性数据传输。同时，通过串口终端实时观察数据传输，进一步验证了通信的可靠性和准确性。实验不仅让我熟悉了蓝牙通信协议的实现和调试方法，还加深了对 BLE 4.0 协议栈架构、连接状态管理及数据传输机制的理解。

## 总结

通过物联网实验，我深入掌握了物联网系统的基本原理和开发流程，包括硬件与软件的协作、传感器数据的采集与传输、以及蓝牙和 ZigBee 等无线通信技术的应用。实验中，我通过操作寄存器实现 LED 控制和定时任务，利用传感器实时监测环境变化并通过串口传输数据，同时通过蓝牙和 ZigBee 模块实现了设备间的无线通信。这些实践不仅让我理解了物联网的核心技术，还提升了我的硬件编程和问题解决能力，为未来深入学习和实际应用奠定了坚实基础。